# 斷詞測試案例
# Word Segmentation Test Cases

## 🧪 測試案例集

### 測試 1：基本詞彙（應該保持完整）

| 輸入 | 預期結果 | 說明 |
|------|---------|------|
| 產品 | 產品 | ✅ 不應拆分 |
| 學生 | 學生 | ✅ 不應拆分 |
| 老師 | 老師 | ✅ 不應拆分 |
| 電腦 | 電腦 | ✅ 不應拆分 |
| 手機 | 手機 | ✅ 不應拆分 |

### 測試 2：連接詞組合（應該拆分）

| 輸入 | 預期結果 | 說明 |
|------|---------|------|
| 而有 | 而、有 | ✅ 應該拆分 |
| 而且 | 而且 | ✅ 是完整詞彙，不拆 |
| 的人 | 的、人 | ✅ 應該拆分 |
| 在學校 | 在、學校 | ✅ 應該拆分 |

### 測試 3：混合句子

| 輸入 | 預期結果 |
|------|---------|
| 學生而有老師 | 學生、而、有、老師 |
| 這個產品很好 | 這、個、產品、很、好 |
| 我在學校學習 | 我、在、學校、學習 |
| 他說的話很對 | 他、說、的、話、很、對 |

---

## 🔍 問題診斷

### 問題 1：「產品」被拆成「產」和「品」

**原因：**
- 「產品」不在 TBCL 或舊詞中
- 原本的智能拆分太激進
- 沒有檢查「產」和「品」是否為單字詞

**修正：**
```javascript
// 修正前（錯誤）
if (!foundWord) {
  results.push(chars[i]);  // 直接拆成單字
  i++;
}

// 修正後（正確）
if (!foundWord) {
  if (SINGLE_CHAR_WORDS.has(chars[i])) {
    results.push(chars[i]);  // 只拆單字詞
    i++;
  } else {
    return [word];  // 保持完整
  }
}
```

---

## ✅ 修正後的邏輯

### 智能拆分決策樹

```
收到詞彙「產品」
  ↓
1. 是單字？否
  ↓
2. 在 TBCL/舊詞？否
  ↓
3. 所有字元都是單字詞？
   「產」是單字詞？否
   「品」是單字詞？否
   → 否
  ↓
4. 嘗試最大匹配
   「產品」在詞庫？否
   「產」在詞庫？否
  ↓
5. 未匹配到已知詞彙
   「產」是單字詞？否
   → 保持完整「產品」✅
```

### 對比：「而有」的處理

```
收到詞彙「而有」
  ↓
1. 是單字？否
  ↓
2. 在 TBCL/舊詞？否
  ↓
3. 所有字元都是單字詞？
   「而」是單字詞？是
   「有」是單字詞？否，但在詞庫
   → 部分是
  ↓
4. 嘗試最大匹配
   「而有」在詞庫？否
   「而」在詞庫？是 ✅
  ↓
5. 繼續處理「有」
   「有」在詞庫？是 ✅
  ↓
結果：而、有 ✅
```

---

## 📋 測試檢查清單

### ✅ 應該保持完整的詞彙

- [ ] 產品
- [ ] 學生
- [ ] 老師
- [ ] 電腦
- [ ] 手機
- [ ] 公司
- [ ] 經理
- [ ] 市場
- [ ] 客戶
- [ ] 服務

### ✅ 應該拆分的組合

- [ ] 而有 → 而、有
- [ ] 的人 → 的、人
- [ ] 在家 → 在、家
- [ ] 從這 → 從、這
- [ ] 到那 → 到、那

### ✅ 應該保持的完整詞彙

- [ ] 而且（連接詞）
- [ ] 因為（連接詞）
- [ ] 所以（連接詞）
- [ ] 不過（連接詞）
- [ ] 但是（連接詞）

---

## 🎯 關鍵原則

### 原則 1：保守拆分

**不確定時，保持完整**

✅ 好：產品（完整）  
❌ 壞：產、品（過度拆分）

---

### 原則 2：單字詞識別

**只拆分已知的單字詞**

✅ 好：而、有（都是單字詞）  
❌ 壞：產、品（不是單字詞）

---

### 原則 3：詞庫優先

**在詞庫中的優先保持**

✅ 好：學生（在詞庫）  
✅ 好：而且（在詞庫）  
❌ 壞：學、生（過度拆分）

---

## 💡 使用建議

### 建議 1：檢查「產品」類詞彙

如果發現「產品」被拆分，請確認：
1. 已更新到最新版本
2. 「詞性規則優化」已啟用
3. 「產品」不在 TBCL 中（可能需要手動切詞）

---

### 建議 2：未知詞彙處理

對於 TBCL 沒有的詞彙（如專有名詞）：
- 系統會保持完整（不會過度拆分）
- 標示為「未知/超綱」
- 可以使用「手動切詞」功能調整

---

### 建議 3：特殊情況

遇到以下情況建議使用「手動切詞」：
- 專有名詞（人名、地名、公司名）
- 專業術語（不在 TBCL 中）
- 古文、文言文
- 新造詞、網路用語

---

## 🔧 除錯指南

### 問題：詞彙被過度拆分

**檢查：**
1. 是否在 TBCL 或舊詞中？
2. 「詞性規則優化」是否啟用？
3. 是否為專有名詞？

**解決：**
- 啟用「詞性規則優化」
- 使用「手動切詞」
- 將詞彙加入「自訂舊詞」

---

### 問題：應該拆分的詞彙未拆分

**檢查：**
1. 詞彙是否在 TBCL 中？（如「而有」不在，「而且」在）
2. 「詞性規則優化」是否啟用？

**解決：**
- 確認啟用「詞性規則優化」
- 檢查是否為完整詞彙（如「而且」本身就是一個詞）
- 使用「手動切詞」

---

## 📊 效能比較

### 修正前 vs 修正後

| 測試詞彙 | 修正前 | 修正後 |
|---------|--------|--------|
| 產品 | 產、品 ❌ | 產品 ✅ |
| 而有 | 而有 ❌ | 而、有 ✅ |
| 學生 | 學生 ✅ | 學生 ✅ |
| 而且 | 而且 ✅ | 而且 ✅ |
| 在學校 | 在、學校 ✅ | 在、學校 ✅ |

---

**版本：** 2.1（已修正）  
**更新日期：** 2025-12-27  
**修正內容：** 防止非單字詞被過度拆分
